## Алгоритм

1) Запустим DFS на всех вершинах графа (если вершина уже обработана - игнорируем).

2) Построим транспонированный граф.

3) Запустим на транспонированном графе DFS от всех вершин в порядке уменьшения времени выхода в исходном графе (если вершина уже обработана - игнорируем).

4) Каждая найденная компонента является КСС исходного графа.

## Псевдокод

![[Pasted image 20250612114746.png]]

## Корректность

### Лемма о временах выхода

Пусть $C$ и $C'$ - различные вершины в [[Конденсация графа|графе конденсации]] (по КСС) исходного графа, такие, что между ними есть (ориентированное) ребро ($(C, C')$), тогда $$t_{out}(C) > t_{out}(C')$$где $$\begin{array}\left t_{out}(C) = \max\limits_{v\ \in\ C}\ t_{out}(v) \\ t_{in}(C) = \min\limits_{v\ \in\ C}\ t_{in}(v) \end{array}$$
#### Доказательство

1) Если $t_{in}(C) < t_{in}(C')$, то DFS посетит сначала какую-то вершину из $C$, затем по ребру $(C, C')$ попадет $C'$. По [[Лемма о белых путях|лемме о белых путях]] из $C'$ алгоритм выйдет не раньше, чем посетит всю $C'$.
2) Иначе ($t_{in}(C') < t_{in}(C)$) DFS посетит всю $C'$, но не сможет попасть в $C$ (так как есть ребро $(C, C')$, то не может быть обратного по свойствам конденсированного графа), то есть DFS обойдёт всю компоненту $C$ до того, как попадёт в $C'$.

### Корректность Косарайю

Докажем по индукции по уменьшению $t_{out}$, что на 3-м шаге каждый запуск DFS посетит одну КСС и только ее.

**База**: Так как стартуем с вершины с max $t_{out}$, в ее КСС нет входящих ребер. Тогда в $G^T$ получаем, что из рассматриваемой компоненты нет ребер в другие, а значит DFS посетит только КСС.

**Шаг**: Те КСС, которые уже рассмотрены, имеют время выхода раньше, поэтому посещены DFS и все их вершины покрашены в чёрный цвет, а значит в обходе $G^T$ в данном запуске мы их посетить не можем и текущая КСС максимальная по времени выхода из оставшихся (сработала база индукции).

- Получили, что алгоритм генерирует КСС, причём в порядке [[Топологическая сортировка|топологической сортировки]], так как он работает по убыванию времени выхода.

## Асимптотика

1) По времени

DFS по двум равноразмерным графам ($G$ и $G^T$) = $2 \cdot O(|V| + |E|)$

Постройка транспонированного графа: $O(|V| + |E|)$

**Итоговая асимптотика**: $O(|V| + |E|)$

2) По памяти

Требуется хранение транспонированного графа + стек dfs.

**Итог**: $O(|V| + ||G||)$
