==Опр.== **Взвешенная сеть** - [[Понятия сети и потока#^cf5b68|сеть]], для рёбер которой определена их стоимость (вес).

==Опр.== **Циркуляция** - это [[Понятия сети и потока#^7828e2|поток]] в орграфе без истока и стока.

==Опр.== **Стоимость [[Понятия сети и потока#^7828e2|потока]]** - $w(f) = \sum\limits_{e \in E} f(e) \cdot w(e)$, где $w(e)$ - стоимость ребра $e$. При этом для стоимости ребра выполняется свойство антисимметричности: $w(u, v) = -w(v, u)$.

- ***Далее будем предполагать, что поток целочисленный.***

### Теорема о разложении циркуляции на простые циклы.

- Любая циркуляция раскладывается в сумму потоков по простым циклам.

#### Доказательство.

Потом допишу

### Критерий оптимальности потока

- Для максимального потока $f$ верно, что в $\mathcal{N}_f$ нет циклов отрицательного веса $\Longleftrightarrow$ $f$ имеет минимальную стоимость.

#### Доказательство.

**Необходимость**: Предположим противное. Тогда $\exists f'$ - максимальный поток минимальной стоимости. Поток $f' - f$ является нулевым (так как в силу максимальности $|f'| = |f|$) $\Rightarrow$
 в нём нет пути из истока в сток и он является циркуляцией. По Т. о разложении циркуляции на простые циклы он раскладывается в простые циклы, а в силу того, что $w(f') - w(f) < 0$ в сети есть хотя бы один невырожденный цикл отрицательного веса. ==Я НЕ ПОНИМАЮ ЧТО ДАЛЬШЕ==
 
**Достаточность**: Предположим противное. Тогда пустим вдоль цикла отрицательного веса поток. Величина потока не изменилась (сколько ушло в цикл, столько и вернулось), а стоимость уменьшилась. Противоречие.

**Нестрого**: Просто посмотрим на отрицательный цикл в остаточной сети. Ему соответствует либо (1) положительный цикл исходной сети с ненулевым потоком, либо (2) не до конца заполненный потоком отрицательный цикл исходной сети. Наша задача минимизировать стоимость. В 1-м случае нам незачем пускать поток по дорогому циклу, поэтому мы его упраздняем. Во 2-м случае мы "добиваем" отрицательный цикл, то есть пускаем единицу потока по циклу пока он не исчезнет (это минимизирует стоимость).

# Алгоритмы поиска минимального максимального потока
## Первый алгоритм

1) Построим произвольный максимальный поток.
2) Пока есть цикл отрицательного веса, пускаем вдоль него поток.

Асимптотика по времени: $O(W |V| |E|^2 |f|)$, где $W$ - максимальный вес ребра.

## Метод дополняющих путей Камео Джонсона

1) Запустим алгоритм Форда-Беллмана для поиска кратчайшего пути из истока в сток и отрицательных циклов.
2) Обновляем остаточную сеть и повторяем пока есть путь из истока в сток или отрицательный цикл.

Утверждение
В ходе алгоритмов не будет порождено циклов отрицательного веса.
Изначально их нет. Покажем, что пропускание потока по кратчайшему
пути их не порождает.
Допустим появилось обратное ребро (v, u) в цикле отрицательного
веса. Тогда из u в v был путь весом меньше w(u, v), но тогда
 кратчайший путь шел бы по этому фрагменту, а не по (u, v).

Применим алгоритм Джонсона с потенциалом относительно истока. (Свойства потенциала выполняются если не было циклов отрицательного веса) При этом кратчайшие пути сохраняются.

Асимптотика по времени: $O(|V||E| + |f||E| \log |V|)$
