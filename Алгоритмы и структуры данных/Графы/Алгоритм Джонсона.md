**Потенциал** - функция $\varphi : V \to \mathbb{R}$

**Потенциальный вес ребра** $w_{\varphi}((u, v)) = weight_{u \to v} + \varphi(u) - \varphi(v)$

**Неотрицательный потенциал**: $\varphi$ - неотрицателен $\Leftrightarrow$ $\forall e \in E\:\ w_{\varphi}(e) \geq 0$

### Лемма о сохранении кратчайших путей

- Если путь $P$ был кратчайшим от $s$ до $t$, то для произвольного потенциала $\varphi$ он же будет кратчайшим относительно $w_{\varphi}$

#### Доказательство.
$w_{\varphi}(P) = \sum\limits_{i=1}^n (weight_{p_i \to p_{i+1}} + \varphi(p_i) - \varphi(p_{i+1})) = \varphi(s) - \varphi(t) +\sum\limits_{i=1}^n weight_{p_i \to p_{i+1}} = \varphi(s) - \varphi(t) + weight_P$ $\Rightarrow$ все пути из $s$ в $t$ меняются на одну и ту же величину. Значит кратчайший путь останется кратчайшим.

### Критерий существования неотрицательного потенциала

- $\exists$ неотрицательный потенциал $\varphi$ для графа $G$ $\Longleftrightarrow$ В $G$ нет циклов отрицательного веса.

#### Доказательство.

**Необходимость**: Рассмотрим произвольный цикл $C$ в $G$. Несложно заметить, что $weight_C = w_{\varphi}(C) \geq 0$. Значит, любой цикл неотрицателен.

**Достаточность**: Добавим в граф новую "мнимую" вершину $s$ и свяжем её со всеми другими вершинами одинаковыми нулевыми рёбрами.

Пусть $\varphi(v) = dist(s, v)$ $\Rightarrow$ $w_{\varphi}(u, v) = \varphi(u) + weight_{u \to v} - \varphi(v) = dist(s, u) + weight_{u \to v} - dist(s, v) \geq 0$
Так как $dist(s, u) + weight_{u \to v} \geq dist(s, v)$ по определению кратчайшего расстояния.

## Алгоритм Джонсона

1) Алгоритмом Форда-Беллмана проверим [[Циклы отрицательного веса|отсутствие циклов отрицательного веса]].
2) Посчитаем $\varphi$ как в критерии существования неотрицательного потенциала.
3) Используем [[Алгоритм Дейкстры|алгоритм Дейкстры]] (или $A^*$) из каждой вершины

### Корректность

### Асимптотика

1) По времени

- Алгоритм Форда-Беллмана за $O(|V||E|)$
- Построение неотрицательного потенциала за $O(|V| + |E|)$
- Алгоритм Дейкстры (зависит от реализации, мы используем двоичную кучу) за $O(|E|\log\ |V|)$

**Итоговая асимптотика по времени**: $O(|V||E|\log |V|)$
