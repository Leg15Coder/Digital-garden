- Дан массив $a$ с определённым на нём отношением порядка. Требуется найти количество пар $(a_i,\ a_j)$ таких элементов, что $a_i > a_j$, но $i < j$.

## Алгоритм

Воспользуемся [[Сортировка слиянием|сортировкой слиянием]] для решения данной задачи. Во время операции слияния, если мы выбираем элемент под $l$, то прибавляем к общему числу инверсий индекс (относительно его части) элемента под $r$.

## Корректность

Тривиальный случай корректен (в массиве из одного элемента 0 инверсий).

Рассмотрим шаг рекурсии: предположим, что мы корректно посчитали количество инверсий в каждой из частей, тогда остались неподсчитанными те и только те инверсии, которые пересекают разрез между частями. Эти инверсии корректно подсчитываются добавленным действием: если $a_l < a_r$, то он меньше всех ещё нерассмотренных элементов, а так как все эти элементы правее него, то $a_l$ не образует с ними инверсию. Все рассмотренные элементы первой части меньше него, но и левее него, то есть они тоже не образуют инверсию, но а рассмотренные элементы второй части меньше него, но (так как вторая часть правее первой) правее, то есть все они образуют инверсию, а их количество равно $|r|$ (при индексации с 0). 
Если же $a_r < a_l$, то инверсии с $a_r$ могут образовывать только элементы первой части, а это мы учтём уже при дальнейших итерациях слияния.

## Асимптотика

Точно такая же, как у [[Сортировка слиянием#Асимптотика|сортировки слиянием]] (добавлена только одна операция за $O(1)$ в операции слияния).

**По времени**: $O(n \log n)$.
**По памяти**: $O(n)$.