
==Опр.== **Представление (View)** - это виртуальная (логическая) таблица, представляющая собой поименованный запрос, который будет подставлен как подзапрос при использовании представления.

*Можно ограничивать права доступа пользователей БД, позволяя им пользоваться представлениями, но не писать свои `SELECT`-запросы*

Представление...
- Не является самостоятельной частью данных.
- Вычисляется динамически на основании данных, хранящихся в реальных таблицах.
- Изменение данных в таблицах должно отражаться в содержимом представлений.
- Скрывает от прикладной программы сложность запросов и саму структуру таблиц БД.
- обеспечивают ещё один уровень защиты данных.

==Опр.== **Обновляемое представление** - представление, к которому применимы операции обновления и удаления данных в таблицах, на которых построено это представление.

==Опр.== **Материализованное представление** - записывают и сохраняют результат как в таблицу.

В материализованных представлениях...
- Обращение работает быстрее, но данные могут не всегда быть актуальными.
- Высокое удобство пользования, если нужно быстро обработать исторические данные, а актуальность за последний период не так важна.

| Характеристика             | Достоинства                                                                                                 | Недостатки                                                                           |
| -------------------------- | ----------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------ |
| **Безопасность**           | ✅ Ограничение доступа к данным (пользователь видит только то, что разрешено через `VIEW`)                   | ❌ Избыточные права могут нивелировать защиту                                         |
| **Простота использования** | ✅ Работа с `VIEW` как с обычной таблицей (прозрачность для приложений)                                      | ❌ Может скрывать сложность реальных запросов                                         |
| **Гибкость структуры**     | ✅ Абстрагирование от изменений в базовых таблицах (можно менять схему БД без изменения запросов приложений) | ❌ Чрезмерное наслоение `VIEW` усложняет поддержку                                    |
| **Производительность**     | —                                                                                                           | ❌ Возможны проблемы с оптимизацией сложных вложенных `VIEW`                          |
| **Обновляемость**          | ✅ Простые `VIEW` могут быть обновляемыми                                                                    | ❌ Не все `VIEW` поддерживают `INSERT/UPDATE/DELETE` (особенно с агрегациями, `JOIN`) |
| **Управляемость**          | ✅ Логическая организация сложных запросов                                                                   | ❌ "Матрёшка" из вложенных `VIEW` усложняет отладку                                   |

##### [[SQL|Синтаксис]]:

```sql
CREATE [OR REPLACE] [TEMP | TEMPORARY] [RECURSIVE]
VIEW view_name [(column_name [,...])]
AS query
[ WITH [ CASCADED | LOCAL ] CHECK OPTION ];
```

- `TEMP | TEMPORARY` – создает временное view, которое исчезнет после окончания сессии.
- `RECURSIVE` – создание рекурсивного view по аналогии с рекурсивными CTE.
- `WITH [ CASCADED | LOCAL ] CHECK OPTION` – правила проверки соответствия добавляемых/обновляемых строк тексту запроса query в случае работы с обновляемыми отношениями.
- `CASCADED` – проверка целостности этого представления и зависимых представлений;
- `LOCAL` – проверка целостности только этого представления.

##### Критерий обновляемости представления:
- Список `FROM` в запросе, определяющем представлении, должен содержать ровно один элемент, и это должна быть таблица или другое изменяемое представление.
- Определение представления не должно содержать предложения `WITH`, `DISTINCT`, `GROUP BY`, `HAVING`, `LIMIT` и `OFFSET` на верхнем уровне запроса.
- Определение представления не должно содержать операции с множествами (`UNION`, `INTERSECT` и `EXCEPT`) на верхнем уровне запроса.
- Список выборки в запросе не должен содержать агрегатные и оконные функции, а также функции, возвращающие множества.
